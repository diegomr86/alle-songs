!function(t,e){var n="object"==typeof exports&&exports&&("object"==typeof t&&t&&t==t.global&&(window=t),exports);"function"==typeof define&&define.amd?define(["rx","exports"],function(n,r){return t.Rx=e(t,r,n),t.Rx}):"object"==typeof module&&module&&module.exports==n?module.exports=e(t,module.exports,require("./rx")):t.Rx=e(t,{},t.Rx)}(this,function(t,e,n,r){function o(){}function i(t,e){return t===e}function s(t){var e,n;if(t&!1)return 2===t;for(e=Math.sqrt(t),n=3;e>=n;){if(t%n===0)return!1;n+=2}return!0}function u(t){var e,n,r;for(e=0;e<x.length;++e)if(n=x[e],n>=t)return n;for(r=1|t;r<x[x.length-1];){if(s(r))return r;r+=2}return t}function h(){return{key:null,value:null,next:0,hashCode:0}}function a(t,e){return t.groupJoin(this,e,function(){return m()},function(t,e){return e})}function c(t){var e=this;return new w(function(n){var r=new y,o=new d,i=new p(o);return n.onNext(E(r,i)),o.add(e.subscribe(function(t){r.onNext(t)},function(t){r.onError(t),n.onError(t)},function(){r.onCompleted(),n.onCompleted()})),o.add(t.subscribe(function(){r.onCompleted(),r=new y,n.onNext(E(r,i))},function(t){r.onError(t),n.onError(t)},function(){r.onCompleted(),n.onCompleted()})),i})}function f(t){var e=this;return new w(function(n){var r,i=new b,s=new d(i),u=new p(s),h=new y;return n.onNext(E(h,u)),s.add(e.subscribe(function(t){h.onNext(t)},function(t){h.onError(t),n.onError(t)},function(){h.onCompleted(),n.onCompleted()})),r=function(){var e,s;try{s=t()}catch(a){return n.onError(a),void 0}e=new v,i.disposable(e),e.disposable(s.take(1).subscribe(o,function(t){h.onError(t),n.onError(t)},function(){h.onCompleted(),h=new y,n.onNext(E(h,u)),r()}))},r(),u})}var l=n.Observable,d=n.CompositeDisposable,p=n.RefCountDisposable,v=n.SingleAssignmentDisposable,b=n.SerialDisposable,y=n.Subject,g=l.prototype,m=l.empty,w=n.Internals.AnonymousObservable,E=(n.Observer.create,n.Internals.addRef),x=[1,3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143,4194301,8388593,16777213,33554393,67108859,134217689,268435399,536870909,1073741789,2147483647],k="no such key",C="duplicate key",z=function(){var t=0;return function(e){var n;if(e===r)throw new Error(k);return e.getHashCode!==r?e.getHashCode():(n=17*t++,e.getHashCode=function(){return n},n)}}(),V=function(t,e){this._initialize(t),this.comparer=e||i,this.freeCount=0,this.size=0,this.freeList=-1};return V.prototype._initialize=function(t){var e,n=u(t);for(this.buckets=new Array(n),this.entries=new Array(n),e=0;n>e;e++)this.buckets[e]=-1,this.entries[e]=h();this.freeList=-1},V.prototype.count=function(){return this.size},V.prototype.add=function(t,e){return this._insert(t,e,!0)},V.prototype._insert=function(t,e,n){this.buckets===r&&this._initialize(0);for(var o=2147483647&z(t),i=o%this.buckets.length,s=this.buckets[i];s>=0;s=this.entries[s].next)if(this.entries[s].hashCode===o&&this.comparer(this.entries[s].key,t)){if(n)throw C;return this.entries[s].value=e,void 0}if(this.freeCount>0){var u=this.freeList;this.freeList=this.entries[u].next,--this.freeCount}else this.size===this.entries.length&&(this._resize(),i=o%this.buckets.length),u=this.size,++this.size;this.entries[u].hashCode=o,this.entries[u].next=this.buckets[i],this.entries[u].key=t,this.entries[u].value=e,this.buckets[i]=u},V.prototype._resize=function(){var t=u(2*this.size),e=new Array(t);for(r=0;r<e.length;++r)e[r]=-1;var n=new Array(t);for(r=0;r<this.size;++r)n[r]=this.entries[r];for(var r=this.size;t>r;++r)n[r]=h();for(var o=0;o<this.size;++o){var i=n[o].hashCode%t;n[o].next=e[i],e[i]=o}this.buckets=e,this.entries=n},V.prototype.remove=function(t){if(this.buckets!==r)for(var e=2147483647&z(t),n=e%this.buckets.length,o=-1,i=this.buckets[n];i>=0;i=this.entries[i].next){if(this.entries[i].hashCode===e&&this.comparer(this.entries[i].key,t))return 0>o?this.buckets[n]=this.entries[i].next:this.entries[o].next=this.entries[i].next,this.entries[i].hashCode=-1,this.entries[i].next=this.freeList,this.entries[i].key=null,this.entries[i].value=null,this.freeList=i,++this.freeCount,!0;o=i}return!1},V.prototype.clear=function(){var t,e;if(!(this.size<=0)){for(t=0,e=this.buckets.length;e>t;++t)this.buckets[t]=-1;for(t=0;t<this.size;++t)this.entries[t]=h();this.freeList=-1,this.size=0}},V.prototype._findEntry=function(t){if(this.buckets!==r)for(var e=2147483647&z(t),n=this.buckets[e%this.buckets.length];n>=0;n=this.entries[n].next)if(this.entries[n].hashCode===e&&this.comparer(this.entries[n].key,t))return n;return-1},V.prototype.count=function(){return this.size-this.freeCount},V.prototype.tryGetEntry=function(t){var e=this._findEntry(t);return e>=0?{key:this.entries[e].key,value:this.entries[e].value}:r},V.prototype.getValues=function(){var t=0,e=[];if(this.entries!==r)for(var n=0;n<this.size;n++)this.entries[n].hashCode>=0&&(e[t++]=this.entries[n].value);return e},V.prototype.get=function(t){var e=this._findEntry(t);if(e>=0)return this.entries[e].value;throw new Error(k)},V.prototype.set=function(t,e){this._insert(t,e,!1)},V.prototype.containskey=function(t){return this._findEntry(t)>=0},g.join=function(t,e,n,r){var i=this;return new w(function(s){var u=new d,h=!1,a=0,c=new V,f=!1,l=0,p=new V;return u.add(i.subscribe(function(t){var n,i,f,l,d=a++,b=new v;c.add(d,t),u.add(b),i=function(){return c.remove(d)&&0===c.count()&&h&&s.onCompleted(),u.remove(b)};try{n=e(t)}catch(y){return s.onError(y),void 0}b.disposable(n.take(1).subscribe(o,s.onError.bind(s),function(){i()})),l=p.getValues();for(var g=0;g<l.length;g++){try{f=r(t,l[g])}catch(m){return s.onError(m),void 0}s.onNext(f)}},s.onError.bind(s),function(){h=!0,(f||0===c.count())&&s.onCompleted()})),u.add(t.subscribe(function(t){var e,i,h,a,d=l++,b=new v;p.add(d,t),u.add(b),i=function(){return p.remove(d)&&0===p.count()&&f&&s.onCompleted(),u.remove(b)};try{e=n(t)}catch(y){return s.onError(y),void 0}b.disposable(e.take(1).subscribe(o,s.onError.bind(s),function(){i()})),a=c.getValues();for(var g=0;g<a.length;g++){try{h=r(a[g],t)}catch(y){return s.onError(y),void 0}s.onNext(h)}},s.onError.bind(s),function(){f=!0,(h||0===p.count())&&s.onCompleted()})),u})},g.groupJoin=function(t,e,n,r){var i=this;return new w(function(s){var u=new d,h=new p(u),a=0,c=new V,f=0,l=new V;return u.add(i.subscribe(function(t){var n,i,f,d,p,b,g=a++,m=new y;c.add(g,m);try{p=r(t,E(m,h))}catch(w){for(d=c.getValues(),f=0;f<d.length;f++)d[f].onError(w);return s.onError(w),void 0}for(s.onNext(p),b=l.getValues(),f=0;f<b.length;f++)m.onNext(b[f]);var x=new v;u.add(x),i=function(){c.remove(g)&&m.onCompleted(),u.remove(x)};try{n=e(t)}catch(w){for(d=c.getValues(),f=0;f<d.length;f++)d[f].onError(w);return s.onError(w),void 0}x.disposable(n.take(1).subscribe(o,function(t){d=c.getValues();for(var e=0,n=d.length;n>e;e++)d[e].onError(t);s.onError(t)},function(){i()}))},function(t){var e,n;for(n=c.getValues(),e=0;e<n.length;e++)n[e].onError(t);s.onError(t)},s.onCompleted.bind(s))),u.add(t.subscribe(function(t){var e,r,i,h=f++;l.add(h,t);var a=new v;u.add(a);var d=function(){l.remove(h),u.remove(a)};try{e=n(t)}catch(p){for(i=c.getValues(),r=0;r<i.length;r++)i[r].onError(p);return s.onError(p),void 0}for(a.disposable(e.take(1).subscribe(o,function(t){i=c.getValues();for(var e=0;e<i.length;e++)i[e].onError(t);s.onError(t)},function(){d()})),i=c.getValues(),r=0;r<i.length;r++)i[r].onNext(t)},function(t){var e,n;for(n=c.getValues(),e=0;e<n.length;e++)n[e].onError(t);s.onError(t)})),h})},g.buffer=function(t,e){return 1===arguments.length&&"function"!=typeof arguments[0]?c.call(this,t).selectMany(function(t){return t.toArray()}):"function"==typeof t?f(t).selectMany(function(t){return t.toArray()}):a(this,t,e).selectMany(function(t){return t.toArray()})},g.window=function(t,e){return 1===arguments.length&&"function"!=typeof arguments[0]?c.call(this,t):"function"==typeof t?f.call(this,t):a.call(this,t,e)},n});